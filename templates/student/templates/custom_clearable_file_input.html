{# custom_clearable_file_input.html #}


{% if widget.is_initial %}
    <div style="display: flex; flex-direction: column; align-items: center;">
        <a href="{{ widget.value.url }}" class="custom-edit-link" style="cursor: pointer; margin-top: 10px; background-color: rgb(50, 153, 201); color: white; padding: 8px 18px; font-size: 16px; font-weight: 600; border: none; border-radius: 10px;">View</a>
        <div class="delete-button" data-url="{% url 'delete_photo' %}" style="cursor: pointer; margin-top: 10px; background-color: rgb(177, 30, 30); color: white; padding: 8px 18px; font-size: 16px; font-weight: 600; border: none; border-radius: 10px;">Delete</div>
    {{ widget.data.file }}
    </div>
{% endif %}
<input  type="file" name="personal-image" accept="image/*" class="custom-edit-input__active" id="id_personal-image">

<script>
document.addEventListener("DOMContentLoaded", function() {
    var csrftoken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    function deletePhoto(url) {
        if (confirm("Are you sure you want to delete this photo?")) {
            fetch(url, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert("Failed to delete photo..");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred while deleting the photo.");
            });
        }
    }

    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', function() {
            var url = this.getAttribute('data-url');
            deletePhoto(url);
        });
    });
});  
</script>